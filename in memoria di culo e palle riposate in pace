--la tortura del culo e delle palle
with culo as (select c.id, avg(voto) as votoMedio, c.professore, c.attivato
              from corsi c join esami e on c.id = e.corso
              group by(c.id)
  ),

palle as (select p.id, p.nome, p.cognome, AVG(votoMedio) as votoMP
          from culo c join professori p on c.professore = p.id
          group by(p.id, p.nome, p.cognome)
  )

select p.nome, p.cognome, c.id
from culo c join palle p on c.professore = p.id
where attivato = true
group by(p.id, p.nome, p.cognome, c.id, votomedio,votoMP)
having votomedio > votoMP

